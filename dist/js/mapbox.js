"use strict";$(function(){function o(o){var t=k.getZoom(),e=1.5*t/Math.pow(2,1.3*t)*10,n=[o.lng-e,o.lat-e],i=[o.lng+e,o.lat+e];return z.features.filter(function(o){var t=o.geometry.coordinates;return t[0]>=n[0]&&t[1]>=n[1]&&t[0]<=i[0]&&t[1]<=i[1]})}function t(){e(),i()}function e(){var o=k.getCenter(),t="/map?lat="+o.lat+"&lon="+o.lng+"&zoom="+k.getZoom();window.history.replaceState(null,null,t)}function n(o){o!=d&&(d=o,d?(v.on.show(),v.off.hide()):(v.on.hide(),v.off.show()),k.once("data",function(o){"style"==o.dataType&&s()}),k.setStyle("mapbox://styles/"+(d?f.imagery:f.basic)))}function i(){k.getZoom()>u.zoom&&!x?(x=!0,y.click(function(){k.easeTo(u)}).removeClass("disabled")):k.getZoom()<=u.zoom&&x&&(x=!1,y.off("click").addClass("disabled"))}function a(o){return void 0===o&&(o=""),function(){b.style.cursor=o}}function c(t){var e=t.features[0].properties,n=k.getZoom(),i=function(){k.easeTo({center:t.lngLat,zoom:p-n<2?p:n+2})};if(e.point_count>5&&n<p)i();else{var a=o(t.lngLat);if(0==a.length)i();else{for(var c=1,r=$("<div>").addClass("photo-list"),l=$("<div>").addClass("markers"),s=function(o){c+=o,c>a.length?c=1:c<1&&(c=a.length),$("figure",r).hide(),$("span",l).removeClass("selected"),$("figure:nth-child("+c+")",r).show(),$("span:nth-child("+c+")",l).addClass("selected")},d=function(){s(-1)},u=function(){s(1)},f=0;f<a.length;f++)r.append(_.photo(a[f])),l.append(_.icon("map-marker"));$("span:first-child",l).addClass("selected"),m.empty().css({top:t.point.y+15,left:t.point.x}).append($("<nav>").append(_.icon("arrow-left",d)).append(l).append(_.icon("arrow-right",u))).append(r).show()}}}function r(o){m.empty().css({top:o.point.y+15,left:o.point.x}).append(_.photo(o.features[0])).show()}function l(o){var t=o.split("/"),e=t[t.length-1].split("_");window.location="/"+e[0]}function s(){k.addSource("photos",{type:"geojson",data:z,cluster:!0,clusterMaxZoom:22,clusterRadius:20}),k.addLayer({id:"cluster",type:"circle",source:"photos",filter:["has","point_count"],paint:{"circle-color":"#524948","circle-radius":{property:"point_count",type:"interval",stops:[[0,13],[50,16],[100,19]]},"circle-opacity":C,"circle-stroke-width":3,"circle-stroke-color":"#ccc"}}),k.addLayer({id:"cluster-count",type:"symbol",source:"photos",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#fff"}}),k.addLayer({id:"photo",type:"circle",source:"photos",filter:["!has","point_count"],paint:{"circle-color":"#f00","circle-radius":7,"circle-stroke-width":4,"circle-stroke-color":"#fdd","circle-opacity":C}}),k.on("mouseenter","cluster",a("pointer")).on("mouseleave","cluster",a()).on("mouseenter","photo",a("pointer")).on("mouseleave","photo",a()).on("move",function(){m.hide()}).on("click",function(){m.hide()}).on("zoomend",t).on("moveend",e).on("mousedown","cluster",c).on("mousedown","photo",r)}var p=18,d=!1,u={zoom:6.5,center:[-116.0987,44.7]},f={basic:"jabbott7/cj1k069f0000p2slh5775akgj",imagery:"jabbott7/cj1mcsd7t000h2rpitaiafuq0"},h=$("#photo-count"),m=$("#photo-preview"),g=$("#toggle-satellite"),y=$("#zoom-out"),v={on:$("nav .glyphicon-check"),off:$("nav .glyphicon-unchecked")},w=new mapboxgl.NavigationControl,k=new mapboxgl.Map({container:"map-canvas",style:"mapbox://styles/"+f.imagery,center:u.center,zoom:u.zoom,maxZoom:p,dragRotate:!1}),b=k.getCanvasContainer(),C=.6,x=!1,z=null,_={icon:function(o,t){var e=$("<span>").addClass("glyphicon glyphicon-"+o);return void 0!==t&&e.click(t),e},coordinate:function(o){var t=Math.pow(10,5),e=function(o){return Math.round(o*t)/t};return e(o[1])+", "+e(o[0])},photo:function(o){var t=o.properties,e="Click or tap to enlarge";return $("<figure>").append($("<img>").attr("src",t.url).attr("title",e).attr("alt",e).click(function(){l(t.url)})).append($("<figcaption>").html(this.coordinate(o.geometry.coordinates)))}};k.addControl(w,"top-right").on("load",function(){g.click(function(){n(!d)}),$.getJSON("/geo.json",function(o){z=o,h.html(z.features.length+" photos").show(),s()})})});
//# sourceMappingURL=/js/maps/mapbox.js.map
