"use strict";$(function(){function o(o,t,e){o?document.addEventListener("keydown",function(o){switch((window.event?window.event:o).keyCode){case 27:z.mapInteraction(o);break;case 37:e();break;case 39:t()}}):document.removeEventListener("keydown")}function t(o){var t=y.getZoom(),e=1.5*t/Math.pow(2,1.3*t)*10,n=[o.lng-e,o.lat-e],i=[o.lng+e,o.lat+e];return b.features.filter(function(o){var t=o.geometry.coordinates;return t[0]>=n[0]&&t[1]>=n[1]&&t[0]<=i[0]&&t[1]<=i[1]})}function e(){var o=y.getCenter(),t="/map?lat="+o.lat+"&lon="+o.lng+"&zoom="+y.getZoom();window.history.replaceState(null,null,t)}function n(o){o!=l&&(l=o,l?(m.on.show(),m.off.hide()):(m.on.hide(),m.off.show()),y.once("data",function(o){"style"==o.dataType&&r()}),y.setStyle("mapbox://styles/"+(l?p.imagery:p.basic)))}function i(){y.getZoom()>s.zoom&&!k?(k=!0,h.click(function(){y.easeTo(s)}).removeClass("disabled")):y.getZoom()<=s.zoom&&k&&(k=!1,h.off("click").addClass("disabled"))}function a(o){return void 0===o&&(o=""),function(){v.style.cursor=o}}function c(o){var t=o.split("/"),e=t[t.length-1].split("_");window.location="/"+e[0]}function r(){y.addSource("photos",{type:"geojson",data:b,cluster:!0,clusterMaxZoom:22,clusterRadius:20}),y.addLayer({id:"cluster",type:"circle",source:"photos",filter:["has","point_count"],paint:{"circle-color":"#524948","circle-radius":{property:"point_count",type:"interval",stops:[[0,13],[50,16],[100,19]]},"circle-opacity":w,"circle-stroke-width":3,"circle-stroke-color":"#ccc"}}),y.addLayer({id:"cluster-count",type:"symbol",source:"photos",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#fff"}}),y.addLayer({id:"photo",type:"circle",source:"photos",filter:["!has","point_count"],paint:{"circle-color":"#f00","circle-radius":7,"circle-stroke-width":4,"circle-stroke-color":"#fdd","circle-opacity":w}}),y.on("mouseenter","cluster",a("pointer")).on("mouseleave","cluster",a()).on("mouseenter","photo",a("pointer")).on("mouseleave","photo",a()).on("move",z.mapInteraction).on("click",z.mapInteraction).on("zoomend",z.zoomEnd).on("moveend",e).on("mousedown","cluster",z.clusterClick).on("mousedown","photo",z.photoClick)}var l=!1,s={zoom:6.5,center:[-116.0987,44.7]},p={basic:"jabbott7/cj1k069f0000p2slh5775akgj",hybrid:"jabbott7/cj1mcsd7t000h2rpitaiafuq0",imagery:"jabbott7/cj1mcsd7t000h2rpitaiafuq0"},d=$("#photo-count"),u=$("#photo-preview"),f=$("#toggle-satellite"),h=$("#zoom-out"),m={on:$("nav .glyphicon-check"),off:$("nav .glyphicon-unchecked")},g=new mapboxgl.NavigationControl,y=new mapboxgl.Map({container:"map-canvas",style:"mapbox://styles/"+p.imagery,center:s.center,zoom:s.zoom,maxZoom:18,dragRotate:!1,keyboard:!1}),v=y.getCanvasContainer(),w=.6,k=!1,b=null,C={icon:function(o,t){var e=$("<span>").addClass("glyphicon glyphicon-"+o);return void 0!==t&&e.click(t),e},coordinate:function(o){var t=Math.pow(10,5),e=function(o){return Math.round(o*t)/t};return e(o[1])+", "+e(o[0])},photo:function(o){var t=o.properties,e="Click or tap to enlarge";return $("<figure>").append($("<img>").attr("src",t.url).attr("title",e).attr("alt",e).click(function(){c(t.url)})).append($("<figcaption>").html(this.coordinate(o.geometry.coordinates)))}},z={zoomEnd:function(){e(),i()},mapInteraction:function(){u.hide(),o(!1)},photoClick:function(o){u.empty().css({top:o.point.y+15,left:o.point.x}).append(C.photo(o.features[0])).show()},clusterClick:function(e){var n=e.features[0].properties,i=y.getZoom(),a=function(){y.easeTo({center:e.lngLat,zoom:18-i<2?18:i+2})};if(n.point_count>5&&i<16)a();else{var c=t(e.lngLat);if(0==c.length)a();else{var r=1,l=$("<div>").addClass("photo-list"),s=$("<div>").addClass("markers"),p=function(o){r+=o,r>c.length?r=1:r<1&&(r=c.length),$("figure",l).hide(),$("span",s).removeClass("selected"),$("figure:nth-child("+r+")",l).show(),$("span:nth-child("+r+")",s).addClass("selected")},d=function(){p(-1)},f=function(){p(1)};o(!0,f,d);for(var h=0;h<c.length;h++)l.append(C.photo(c[h])),s.append(C.icon("map-marker"));$("span:first-child",s).addClass("selected"),u.empty().css({top:e.point.y+15,left:e.point.x}).append($("<nav>").append(C.icon("arrow-left",d)).append(s).append(C.icon("arrow-right",f))).append(l).show()}}}};y.addControl(g,"top-right").on("load",function(){f.click(function(){n(!l)}),$.getJSON("/geo.json",function(o){b=o,d.html(b.features.length+" photos").show(),r(),y.resize()})})});
//# sourceMappingURL=/js/maps/mapbox.js.map
