"use strict";$(function(){function o(o){var t=x.getZoom(),e=1.5*t/Math.pow(2,1.3*t)*10,n=[o.lng-e,o.lat-e],i=[o.lng+e,o.lat+e];return j.features.filter(function(o){var t=o.geometry.coordinates;return t[0]>=n[0]&&t[1]>=n[1]&&t[0]<=i[0]&&t[1]<=i[1]})}function t(){e(),c()}function e(){var o=x.getCenter(),t="/map?lat="+o.lat+"&lon="+o.lng+"&zoom="+x.getZoom();window.history.replaceState(null,null,t)}function n(o){var t=Math.pow(10,d),e=function(o){return Math.round(o*t)/t};return e(o.lat)+", "+e(o.lng)}function i(o){o!=f&&(f=o,f?(b.on.show(),b.off.hide()):(b.on.hide(),b.off.show()),x.once("data",function(o){"style"==o.dataType&&p()}),x.setStyle("mapbox://styles/"+(f?h.imagery:h.basic)))}function c(){x.getZoom()>m.zoom&&!_?(_=!0,w.click(function(){x.easeTo(m)}).removeClass("disabled")):x.getZoom()<=m.zoom&&_&&(_=!1,w.off("click").addClass("disabled"))}function r(o){return void 0===o&&(o=""),function(){z.style.cursor=o}}function a(t){var e=t.features[0].properties,i=x.getZoom(),c=function(){x.easeTo({center:t.lngLat,zoom:u-i<2?u:i+2})};if(e.point_count>5&&i<u)c();else{var r=o(t.lngLat);if(0==r.length)c();else{for(var a=$("<div>").addClass("photo-list"),l=0;l<r.length;l++){var p=r[l].properties;a.append($("<img>").attr("src",p.url))}y.empty().append(a).append($("<div>").html(n(t.lngLat))).css({top:t.point.y+15,left:t.point.x}).click(function(){s(p.url)}).show()}}}function l(o){var t=o.features[0].properties;y.empty().append($("<img>").attr("src",t.url)).append($("<div>").html(n(o.lngLat))).css({top:o.point.y,left:o.point.x}).click(function(){s(t.url)}).show()}function s(o){var t=o.split("/"),e=t[t.length-1].split("_");window.location="/"+e[0]}function p(){x.addSource("photos",{type:"geojson",data:j,cluster:!0,clusterMaxZoom:22,clusterRadius:20}),x.addLayer({id:"cluster",type:"circle",source:"photos",filter:["has","point_count"],paint:{"circle-color":"#524948","circle-radius":{property:"point_count",type:"interval",stops:[[0,13],[50,16],[100,19]]},"circle-opacity":C,"circle-stroke-width":3,"circle-stroke-color":"#ccc"}}),x.addLayer({id:"cluster-count",type:"symbol",source:"photos",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#fff"}}),x.addLayer({id:"photo",type:"circle",source:"photos",filter:["!has","point_count"],paint:{"circle-color":"#f00","circle-radius":7,"circle-stroke-width":4,"circle-stroke-color":"#fdd","circle-opacity":C}}),x.on("mouseenter","cluster",r("pointer")).on("mouseleave","cluster",r()).on("mouseenter","photo",r("pointer")).on("mouseleave","photo",r()).on("move",function(){y.hide()}).on("click",function(){y.hide()}).on("zoomend",t).on("moveend",e).on("mousedown","cluster",a).on("mousedown","photo",l)}var u=18,d=5,f=!1,m={zoom:6.5,center:[-116.0987,44.7]},h={basic:"jabbott7/cj1k069f0000p2slh5775akgj",imagery:"jabbott7/cj1mcsd7t000h2rpitaiafuq0"},g=$("#photo-count"),y=$("#photo-preview"),v=$("#toggle-satellite"),w=$("#zoom-out"),b={on:$("nav .glyphicon-check"),off:$("nav .glyphicon-unchecked")},k=new mapboxgl.NavigationControl,x=new mapboxgl.Map({container:"map-canvas",style:"mapbox://styles/"+h.imagery,center:m.center,zoom:m.zoom,maxZoom:u,dragRotate:!1}),z=x.getCanvasContainer(),C=.6,_=!1,j=null;x.addControl(k,"top-right").on("load",function(){v.click(function(){i(!f)}),$.getJSON("/geo.json",function(o){j=o,g.html(j.features.length+" photos").show(),p()})})});
//# sourceMappingURL=/js/maps/mapbox.js.map
