"use strict";$(function(){function o(o){return void 0===o&&(o=""),function(){u.style.cursor=o}}function t(o){var t=o.split("/"),e=t[t.length-1].split("_");window.location="/"+e[0]}function e(){p.addSource("photos",{type:"geojson",data:f,cluster:!0,clusterMaxZoom:15,clusterRadius:20}),p.addLayer({id:"cluster",type:"circle",source:"photos",filter:["has","point_count"],paint:{"circle-color":"#524948","circle-radius":{property:"point_count",type:"interval",stops:[[0,13],[50,17],[100,20]]},"circle-opacity":d,"circle-stroke-width":3,"circle-stroke-color":"#ccc"}}),p.addLayer({id:"cluster-count",type:"symbol",source:"photos",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#fff"}}),p.addLayer({id:"photo",type:"circle",source:"photos",filter:["!has","point_count"],paint:{"circle-color":"#f00","circle-radius":7,"circle-stroke-width":4,"circle-stroke-color":"#fdd","circle-opacity":d}}),p.on("mouseenter","cluster",o("pointer")).on("mouseleave","cluster",o()).on("mouseenter","photo",o("pointer")).on("mouseleave","photo",o()).on("move",function(){r.hide()}).on("click",function(){r.hide()}),p.on("mousedown","cluster",function(o){o.features[0].properties.point_count>5?p.easeTo({center:o.lngLat,zoom:p.getZoom()+2}):(new mapboxgl.LngLatBounds(o.lngLat,o.lngLat),console.log(p.getSource("photos")))}),p.on("mousedown","photo",function(o){var e=o.features[0].properties;r.empty().append($("<img>").attr("src",e.url)).append($("<div>").html(o.lngLat.lat+", "+o.lngLat.lng)).css({top:o.point.y,left:o.point.x}).click(function(){t(e.url)}).show()})}var n=!1,c={street:"streets-v9",imagery:"satellite-streets-v9"},i=$("#photo-count"),r=$("#photo-preview"),l=$("#toggle-satellite"),s={on:$("nav .glyphicon-check"),off:$("nav .glyphicon-unchecked")},a=new mapboxgl.NavigationControl,p=new mapboxgl.Map({container:"map-canvas",style:"mapbox://styles/mapbox/streets-v9",center:[-116.0987,44.7],zoom:6.5,dragRotate:!1}),u=p.getCanvasContainer(),d=.6,f=null;p.addControl(a,"top-right").on("load",function(){l.click(function(){n=!n,n?(s.on.show(),s.off.hide()):(s.on.hide(),s.off.show()),p.once("data",function(o){"style"==o.dataType&&e()}).setStyle("mapbox://styles/mapbox/"+(n?c.imagery:c.street))}),$.getJSON("/geo.json",function(o){f=o,i.html(f.features.length+" photos").show(),e()})})});
//# sourceMappingURL=/js/maps/mapbox.js.map
