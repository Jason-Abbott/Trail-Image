"use strict";$(function(){function o(o){var t=[o.lng-1,o.lat-1],e=[o.lng+1,o.lat+1];return _.features.filter(function(o){var n=o.geometry.coordinates;return n[0]>=t[0]&&n[1]>=t[1]&&n[0]<=e[0]&&n[1]<=e[1]})}function t(o){var t=Math.pow(10,u),e=function(o){return Math.round(o*t)/t};return e(o.lat)+", "+e(o.lng)}function e(o){o!=p&&(p=o,p?(v.on.show(),v.off.hide()):(v.on.hide(),v.off.show()),w.once("data",function(o){"style"==o.dataType&&l()}),w.setStyle("mapbox://styles/"+(p?f.imagery:f.basic)))}function n(){w.getZoom()>d.zoom&&!z?(z=!0,y.click(function(){w.easeTo(d)}).removeClass("disabled")):w.getZoom()<=d.zoom&&z&&(z=!1,y.off("click").addClass("disabled"))}function c(o){return void 0===o&&(o=""),function(){k.style.cursor=o}}function i(t){var e=t.features[0].properties,n=w.getZoom();if(e.point_count>5&&n<s)w.easeTo({center:t.lngLat,zoom:s-n<2?s:n+2});else{var c=o(t.lngLat);console.log(c)}}function r(o){var e=o.features[0].properties;m.empty().append($("<img>").attr("src",e.url)).append($("<div>").html(t(o.lngLat))).css({top:o.point.y,left:o.point.x}).click(function(){a(e.url)}).show()}function a(o){var t=o.split("/"),e=t[t.length-1].split("_");window.location="/"+e[0]}function l(){w.addSource("photos",{type:"geojson",data:_,cluster:!0,clusterMaxZoom:22,clusterRadius:20}),w.addLayer({id:"cluster",type:"circle",source:"photos",filter:["has","point_count"],paint:{"circle-color":"#524948","circle-radius":{property:"point_count",type:"interval",stops:[[0,13],[50,17],[100,20]]},"circle-opacity":x,"circle-stroke-width":3,"circle-stroke-color":"#ccc"}}),w.addLayer({id:"cluster-count",type:"symbol",source:"photos",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#fff"}}),w.addLayer({id:"photo",type:"circle",source:"photos",filter:["!has","point_count"],paint:{"circle-color":"#f00","circle-radius":7,"circle-stroke-width":4,"circle-stroke-color":"#fdd","circle-opacity":x}}),w.on("mouseenter","cluster",c("pointer")).on("mouseleave","cluster",c()).on("mouseenter","photo",c("pointer")).on("mouseleave","photo",c()).on("move",function(){m.hide()}).on("click",function(){m.hide()}).on("zoomend",n).on("mousedown","cluster",i).on("mousedown","photo",r)}var s=18,u=5,p=!1,d={zoom:6.5,center:[-116.0987,44.7]},f={basic:"jabbott7/cj1k069f0000p2slh5775akgj",imagery:"mapbox/satellite-streets-v9"},h=$("#photo-count"),m=$("#photo-preview"),g=$("#toggle-satellite"),y=$("#zoom-out"),v={on:$("nav .glyphicon-check"),off:$("nav .glyphicon-unchecked")},b=new mapboxgl.NavigationControl,w=new mapboxgl.Map({container:"map-canvas",style:"mapbox://styles/"+f.basic,center:d.center,zoom:d.zoom,maxZoom:s,dragRotate:!1}),k=w.getCanvasContainer(),x=.6,z=!1,_=null;w.addControl(b,"top-right").on("load",function(){g.click(function(){e(!p)}),$.getJSON("/geo.json",function(o){_=o,h.html(_.features.length+" photos").show(),l()})})});
//# sourceMappingURL=/js/maps/mapbox.js.map
