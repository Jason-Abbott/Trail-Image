"use strict";function showPhoto(t,e){if(e&&t){var o=t.getProperty("preview"),a=t.getProperty("id"),i=t.getGeometry(),n=t.getProperty("partSlug");e.setOptions({content:'<a href="/'+(n||mapSlug)+"#"+a+'"><img src="'+o+'"/></a>',position:i.get()}),e.open(ti.map)}}function loadPostTrack(t){ti.map.data.forEach(function(t){ti.map.data.remove(t)}),mapSlug=t,ti.miles=0,ti.hours=0,ti.topSpeed=0,ti.avgSpeed=0,ti.count=0,ti.bounds=new google.maps.LatLngBounds,window.history.pushState(null,null,"/"+mapSlug+"/map"),ti.map.data.loadGeoJson("/"+mapSlug+"/geo.json")}function hoursAndMinutes(t){var e=Math.floor(t),o=Math.round(60*(t-e)).toString();return o.length<2&&(o="0"+o),e+":"+o}function extend(t,e){e instanceof google.maps.LatLng?t.extend(e):e instanceof google.maps.Data.Point?t.extend(e.get()):e.getArray().forEach(function(e){extend(t,e)})}var ti={timer:0,map:null,bounds:null,miles:0,hours:0,topSpeed:0,avgSpeed:0,count:0,geo:null};google.maps.event.addDomListener(window,"load",function(){var t=document.getElementById("map-canvas"),e=new google.maps.InfoWindow,o=null;ti.bounds=new google.maps.LatLngBounds,ti.map=new google.maps.Map(t,{mapTypeId:google.maps.MapTypeId.HYBRID}),ti.map.data.setStyle(function(t){return parseInt(t.getProperty("id"))==mapPhotoID&&(o=t),{icon:"/img/orange-marker.png",clickable:t.getGeometry()instanceof google.maps.Data.Point,strokeWeight:2,strokeColor:"red"}}),ti.map.data.addListener("addfeature",function(t){window.clearTimeout(ti.timer),ti.geo=t.feature.getGeometry();var a=0;extend(ti.bounds,ti.geo),(ti.geo instanceof google.maps.Data.LineString||ti.geo instanceof google.maps.Data.MultiLineString)&&(ti.count++,ti.miles+=t.feature.getProperty("distance"),ti.hours+=t.feature.getProperty("duration"),a=parseFloat(t.feature.getProperty("topSpeed")),a>ti.topSpeed&&(ti.topSpeed=a),a=parseFloat(t.feature.getProperty("avgSpeed")),ti.avgSpeed=(ti.avgSpeed*(ti.count-1)+a)/ti.count),ti.timer=window.setTimeout(function(){ti.map.fitBounds(ti.bounds);var t=$("#summary"),a=$("#gpx-download");ti.miles>0?(t.show(),allowDownload&&a.show(),$("#distance").html(ti.miles.toFixed(1)),$("#duration").html(hoursAndMinutes(ti.hours)),ti.topSpeed>0?$("#top-speed").html(ti.topSpeed.toFixed(1)):$("#top-speed,#top-speed-label").hide(),ti.avgSpeed>0?$("#avg-speed").html(ti.avgSpeed.toFixed(1)):$("#avg-speed,#avg-speed-label").hide()):t.hide(),o&&showPhoto(o,e)},200)}),ti.map.data.addListener("click",function(t){showPhoto(t.feature,e)}),ti.map.data.addListener("mouseover",function(t){ti.map.data.overrideStyle(t.feature,{icon:"/img/camera-marker.png"})}),ti.map.data.addListener("mouseout",function(t){ti.map.data.revertStyle()}),ti.map.data.loadGeoJson("/"+mapSlug+"/geo.json")});