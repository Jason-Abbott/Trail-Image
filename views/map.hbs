{{#contentFor "head"}}
	<script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
	<script type='text/javascript'>
		var timer = 0;

		google.maps.event.addDomListener(window, 'load', function()
		{
			var canvas = document.getElementById('map-canvas');
			var preview = new google.maps.InfoWindow();
			var bounds = new google.maps.LatLngBounds();
			var map = new google.maps.Map(canvas, { mapTypeId: google.maps.MapTypeId.HYBRID	});

			// https://developers.google.com/maps/documentation/javascript/datalayer#style_options
			// http://mapicons.nicolasmollet.com/
			map.data.setStyle(function(feature)
			{
				return {
					icon: '/img/camera-marker.png',
					strokeWeight: 2,
					strokeColor: 'red'
				};
			});

			map.data.addListener('addfeature', function(event)
			{
				clearTimeout(timer);
				extend(bounds, event.feature.getGeometry());
				timer = setTimeout(function() { map.fitBounds(bounds); }, 200);
			});

			// https://developers.google.com/maps/documentation/javascript/examples/layer-data-dragndrop
			map.data.addListener('click', function(event)
			{
				var image = event.feature.getProperty('preview');

				if (preview)
				{
					var id = event.feature.getProperty('id');
					var geo = event.feature.getGeometry();

					preview.setOptions({
						content: '<a href="/{{post.slug}}#' + id + '"><img src="' + image + '"/></a>',
						position: geo.get()
					});
					preview.open(map);
				}
			});

			map.data.addListener('mouseover', function(event)
			{
				map.data.overrideStyle(event.feature, {icon: '/img/camera-marker-hover.png'});
			});

			map.data.addListener('mouseout', function(event)
			{
				map.data.revertStyle();
			});

			map.data.loadGeoJson('/{{post.slug}}/geo.json');
		});

		/**
		 * Update a map's viewport to fit each geometry in a dataset
		 * @param {google.maps.LatLngBounds} bounds
		 * @param {google.maps.Geometry|google.maps.Point} geometry coordinates to apply
		 */
		function extend(bounds, geometry)
		{
			if (geometry instanceof google.maps.LatLng)
			{
				bounds.extend(geometry);
			}
			else if (geometry instanceof google.maps.Data.Point)
			{
				bounds.extend(geometry.get());
			}
			else
			{
				geometry.getArray().forEach(function(g) { extend(bounds, g); });
			}
		}
	</script>
	<style>
		body { margin: 0; padding: 0; }
		#map-canvas	{ width: 100%; height: 100%; }
	</style>
{{/contentFor}}

<div id="map-canvas"></div>
