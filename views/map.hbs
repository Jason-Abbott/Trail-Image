{{#contentFor "head"}}
	<script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
	<link href='http://fonts.googleapis.com/css?family=Audiowide' rel='stylesheet' type='text/css'>
	<link href='/css/map.css' rel='stylesheet' type='text/css'/>
	<script type='text/javascript'>
		var timer = 0;

		google.maps.event.addDomListener(window, 'load', function()
		{
			var miles = 0;
			var canvas = document.getElementById('map-canvas');
			var preview = new google.maps.InfoWindow();
			var bounds = new google.maps.LatLngBounds();
			var map = new google.maps.Map(canvas, { mapTypeId: google.maps.MapTypeId.HYBRID	});
			var photoID = {{photoID}};

			// https://developers.google.com/maps/documentation/javascript/datalayer#style_options
			// https://developers.google.com/maps/documentation/javascript/symbols
			// http://mapicons.nicolasmollet.com/
			map.data.setStyle(function(feature)
			{
				var selected = parseInt(feature.getProperty('id')) == photoID;

				return {
					icon: (selected) ? '/img/camera-marker-selected.png' : '/img/camera-marker.png',
//					icon: {
//						path: 'M 352 288 C 352 341 309 384 256 384 C 203 384 160 341 160 288 C 160 235 203 192 256 192 C 309 192 352 235 352 288 M 512 160 L 512 416 C 512 451.3 483.3 480 448 480 L 64 480 C 28.7 480 0 451.3 0 416 L 0 160 C 0 124.7 28.7 96 64 96 L 160 96 L 160 64 C 160 46.3 174.3 32 192 32 L 320 32 C 337.7 32 352 46.3 352 64 L 352 96 L 448 96 C 483.3 96 512 124.7 512 160 M 384 288 C 384 217.4 326.6 160 256 160 C 185.4 160 128 217.4 128 288 C 128 358.6 185.4 416 256 416 C 326.6 416 384 358.6 384 288 M 480 128 L 384 128 L 384 192 L 480 192 L 480 128',
//						scale: 0.05,
//						strokeColor: 'red',
//						fillColor: 'red',
//						fillOpacity: 0.8
//					},
					strokeWeight: 2,
					strokeColor: 'red'
				};
			});

			map.data.addListener('addfeature', function(event)
			{
				clearTimeout(timer);
				extend(bounds, event.feature.getGeometry());

				var distance = event.feature.getProperty('distance');

				if (distance) { miles += distance; }

				timer = setTimeout(function()
				{
					map.fitBounds(bounds);
					$('#distance').html(miles);
				},
						200);
			});

			// https://developers.google.com/maps/documentation/javascript/examples/layer-data-dragndrop
			map.data.addListener('click', function(event)
			{
				var image = event.feature.getProperty('preview');

				if (preview)
				{
					var id = event.feature.getProperty('id');
					var geo = event.feature.getGeometry();

					preview.setOptions({
						content: '<a href="/{{post.slug}}#' + id + '"><img src="' + image + '"/></a>',
						position: geo.get()
					});
					preview.open(map);
				}
			});

			map.data.addListener('mouseover', function(event)
			{
				map.data.overrideStyle(event.feature, {icon: '/img/camera-marker-hover.png'});
			});

			map.data.addListener('mouseout', function(event)
			{
				map.data.revertStyle();
			});

			map.data.loadGeoJson('/{{post.slug}}/geo.json');
		});

		/**
		 * Update a map's viewport to fit each geometry in a dataset
		 * @param {google.maps.LatLngBounds} bounds
		 * @param {google.maps.Geometry|google.maps.Point} geometry coordinates to apply
		 */
		function extend(bounds, geometry)
		{
			if (geometry instanceof google.maps.LatLng)
			{
				bounds.extend(geometry);
			}
			else if (geometry instanceof google.maps.Data.Point)
			{
				bounds.extend(geometry.get());
			}
			else
			{
				geometry.getArray().forEach(function(g) { extend(bounds, g); });
			}
		}
	</script>
{{/contentFor}}

<div id="map-canvas"></div>
<div id="summary">
	Miles
	<div class="lcd" id="distance">0</div>
	Hours
	<div class="lcd" id="duration">0</div>
	Top Speed
	<div class="lcd" id="top-speed">0</div>
	Avg Speed
	<div class="lcd" id="avg-speed">0</div>
</div>
