"use strict";$(function(){var s="Post",t=$("figure"),c=$("#light-box");function u(){$("html").css("overflow","hidden"),document.ontouchmove=function(t){t.preventDefault()}}function e(){$("html").css("overflow","auto"),$(window).off("resize"),document.ontouchmove=null}c.on("click",function(){c.off("mousemove").hide(0,e)}),t.find("img").on("click",function(t){function e(t){var e="zoom-out";n.update(),n.needsToPan?(e="move",c.on("mousemove",h),c.on("touchstart",d),c.on("touchmove",l)):(c.off("mousemove",h),c.off("touchstart",d),c.off("touchmove",l)),h(t),r.css("cursor",e)}function a(t){var e=0,i=0,o=t.targetTouches;return void 0!==o&&(e=o[0].clientX,i=o[0].clientY),[e,i]}var i=$(this),r=c.find("img"),o=i.data("big-loaded"),n=new p(i.data("big-width"),i.data("big-height")),f={top:0,left:0},h=function(t){var e=t.clientX,i=t.clientY;void 0!==e&&void 0!==i&&r.css({top:n.height.CSS(i),left:n.width.CSS(e)})},d=function(t){var e=r.position(),i=a(t),o=i[0],n=i[1];f.left=e.left-o,f.top=e.top-n},l=function(t){var e=a(t),i=e[0],o=e[1];r.css({top:f.top+o,left:f.left+i})};void 0===o&&(o=!1);o?r.attr("src",i.data("big")):(r.attr("src",i.data("original")),$("<img />").bind("load",function(){r.attr("src",this.src),i.data("big-loaded",!0)}).attr("src",i.data("big")));r.height(n.height.image).width(n.width.image),e(t),c.show(0,u),$(window).resize(e),util.log.event(s,"Show Lightbox")}).lazyload(),t.find(".mobile-button").on("touchstart",function(t){var e=$(this),i="mobile-info",o="info-visible",n="info-loaded",a="active",r=e.parent();t.preventDefault(),t.stopImmediatePropagation(),r.data(o)?(e.removeClass(a),r.data(o,!1).find("."+i).hide()):(e.addClass(a),r.data(o,!0),r.data(n)?r.find("."+i).show():($("<div/>").addClass(i).load(r.data("exif"),function(){$(this).appendTo(r),r.data(n,!0)}),util.log.event(s,"Show Photo Info","Mobile")))}),t.find(".info-button").one("mouseover",function(){var t=$(this);t.addClass("loading").html(function(t,e){return util.html.icon(t).get(0).outerHTML+"<p>"+e+"</p>"}("cloud_download","Loading â€¦")).load(t.parent().data("exif"),function(){t.removeClass("loading").addClass("loaded")}),util.log.event(s,"Show Photo Info")});var i=(o.prototype.update=function(t){this.window=t,this.extra=(this.window-this.image)/2},o.prototype.ratio=function(){return(this.window-this.image)/this.window*2},o.prototype.CSS=function(t){var e=0<this.extra?0:(this.window/2-t)*this.panRatio;return(this.extra-e).toFixed(0)+"px"},o);function o(t){this.image=parseInt(t),this.window=0,this.extra=0,this.panRatio=0}var p=(n.prototype.update=function(){this.height.update(window.innerHeight),this.width.update(window.innerWidth),this.needsToPan=this.width.extra<0||this.height.extra<0,this.needsToPan&&(this.height.panRatio=this.width.panRatio=this.width.extra<this.height.extra&&this.width.extra<0?this.width.ratio():this.height.ratio())},n);function n(t,e){this.width=new i(t),this.height=new i(e)}}),$(function(){$(".static-map").each(function(t,e){var i=$(e),o=i.data("locations"),n=i.data("href");if(o&&n&&0<o.length){var a=o.map(function(t){return"url-"+encodeURIComponent("https://www.trailimage.com/p.png("+t[0]+","+t[1]+")")});i.attr("src",n.replace("-pins-",a.join(",")))}})}),function(f,o,n,h){var d=f(o);f.fn.lazyload=function(t){var e,a=this,r={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:o,data_attribute:"original",skip_invisible:!1,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};function i(){var e=0;a.each(function(){var t=f(this);if(!r.skip_invisible||t.is(":visible"))if(f.abovethetop(this,r)||f.leftofbegin(this,r));else if(f.belowthefold(this,r)||f.rightoffold(this,r)){if(++e>r.failure_limit)return!1}else t.trigger("appear"),e=0})}return t&&(h!==t.failurelimit&&(t.failure_limit=t.failurelimit,delete t.failurelimit),h!==t.effectspeed&&(t.effect_speed=t.effectspeed,delete t.effectspeed),f.extend(r,t)),e=r.container===h||r.container===o?d:f(r.container),0===r.event.indexOf("scroll")&&e.bind(r.event,function(){return i()}),this.each(function(){var o=this,n=f(o);o.loaded=!1,n.attr("src")!==h&&!1!==n.attr("src")||n.is("img")&&n.attr("src",r.placeholder),n.one("appear",function(){if(!this.loaded){if(r.appear){var t=a.length;r.appear.call(o,t,r)}f("<img />").bind("load",function(){var t=n.attr("data-"+r.data_attribute);n.hide(),n.is("img")?n.attr("src",t):n.css("background-image","url('"+t+"')"),n[r.effect](r.effect_speed),o.loaded=!0;var e=f.grep(a,function(t){return!t.loaded});if(a=f(e),r.load){var i=a.length;r.load.call(o,i,r)}}).attr("src",n.attr("data-"+r.data_attribute))}}),0!==r.event.indexOf("scroll")&&n.bind(r.event,function(){o.loaded||n.trigger("appear")})}),d.bind("resize",function(){i()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&d.bind("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&a.each(function(){f(this).trigger("appear")})}),f(n).ready(function(){i()}),this},f.belowthefold=function(t,e){return(e.container===h||e.container===o?(o.innerHeight?o.innerHeight:d.height())+d.scrollTop():f(e.container).offset().top+f(e.container).height())<=f(t).offset().top-e.threshold},f.rightoffold=function(t,e){return(e.container===h||e.container===o?d.width()+d.scrollLeft():f(e.container).offset().left+f(e.container).width())<=f(t).offset().left-e.threshold},f.abovethetop=function(t,e){return(e.container===h||e.container===o?d.scrollTop():f(e.container).offset().top)>=f(t).offset().top+e.threshold+f(t).height()},f.leftofbegin=function(t,e){return(e.container===h||e.container===o?d.scrollLeft():f(e.container).offset().left)>=f(t).offset().left+e.threshold+f(t).width()},f.inviewport=function(t,e){return!(f.rightoffold(t,e)||f.leftofbegin(t,e)||f.belowthefold(t,e)||f.abovethetop(t,e))},f.extend(f.expr[":"],{"below-the-fold":function(t){return f.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!f.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return f.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!f.rightoffold(t,{threshold:0})},"in-viewport":function(t){return f.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!f.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return f.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!f.rightoffold(t,{threshold:0})}})}(jQuery,window,document);
//# sourceMappingURL=/js/maps/post.js.map
