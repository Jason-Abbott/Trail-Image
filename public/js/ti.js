function preparePhotos(){var $photos=$(".photo");$photos.find("img").lazyload(),$photos.find(".exif").mouseenter(function(){var $exif=$(this);$exif.off("mouseenter").html('<span class="glyphicon glyphicon-download"></span><p>Loading â€¦</p>').load($exif.data("url"))})}function prepareMenu(){var css="selected",$title=$("#menu-title"),$rootList=$("#menu-root"),$tagList=$("#menu-tag"),$postList=$("#menu-post"),$description=$("#post-description"),selection=loadMenuSelection(["When",null]);$title.one("click",function(){for(var root in TrailImage.menu){var $li=$("<li>").text(root);$rootList.append($li),root==selection[0]&&($li.addClass(css),loadTags(selection))}}).click(toggleMenu),$rootList.on("click","li",function(){var $li=$(this);selection=[$li.text(),null],menuSelect($rootList,$li,loadTags,selection)}),$tagList.on("click","li",function(){var $li=$(this);selection[1]=$li.text(),menuSelect($tagList,$li,loadPosts,selection)}),$postList.on("click","li.post",showSelection).on("mouseover","li.post",function(){$description.html($(this).data("description"))}).on("mouseout",function(){$description.empty()})}function toggleMenu(){var css="selected",$title=$("#menu-title"),$up=$title.find(".glyphicon-chevron-up"),$down=$title.find(".glyphicon-chevron-down"),$menu=$("#menu"),show=function(){$title.addClass(css),$menu.show(),$up.show(),$down.hide()},hide=function(){$title.removeClass(css),$menu.hide(),$up.hide(),$down.show()};$title.hasClass(css)?hide():(show(),$(".content:not(#header), .map").one("click",hide))}function showSelection(){var slug=$(this).data("slug");"undefined"!=typeof loadPostTrack?loadPostTrack(slug):window.location.href="/"+slug,toggleMenu()}function menuSelect($list,$clicked,loader,selection){$list.find("li").removeClass("selected"),loader(selection),$clicked.addClass("selected"),saveMenuSelection(selection)}function loadTags(selection){var $tagList=$("#menu-tag"),tags=TrailImage.menu[selection[0]];$tagList.empty(),null==selection[1]&&(selection[1]=tags[0].title);for(var i=0;tags.length>i;i++){var $li=$("<li>").text(tags[i].title);$tagList.append($li),tags[i].title==selection[1]&&($li.addClass("selected"),loadPosts(selection))}}function loadPosts(selection){var $postList=$("#menu-post"),tags=TrailImage.menu[selection[0]];$postList.empty();for(var i=0;tags.length>i;i++)if(tags[i].title==selection[1])for(var ids=tags[i].posts,j=0;ids.length>j;j++){var post=TrailImage.post[ids[j]],title=post.title;if(post.part&&ids.length-1>j&&title==TrailImage.post[ids[j+1]].title){for(var $ol=$("<ol>");ids.length>j&&TrailImage.post[ids[j]].title==title;)post=TrailImage.post[ids[j]],$ol.prepend($("<li>").addClass("post").attr("value",post.part).html(post.subTitle).data("description",post.description).data("slug",post.slug)),j++;j--,post=TrailImage.post[ids[j]],$postList.append($("<li>").addClass("series").html('<span class="mode-icon '+post.icon+'"></span>'+post.title).append($ol))}else post.part&&(title+=": "+post.subTitle),$postList.append($("<li>").addClass("post").html('<span class="mode-icon '+post.icon+'"></span>'+title).data("description",post.description).data("slug",post.slug))}}function loadMenuSelection(ifNone){var re=RegExp("\\bmenu=([^;\\b]+)","gi"),match=re.exec(document.cookie);return null==match?ifNone:match[1].split(",")}function saveMenuSelection(selection){"string"==typeof selection&&(selection=[selection,null]),document.cookie="menu="+selection.join()}$(function(){prepareMenu(),preparePhotos()}),function($,window,document,undefined){var $window=$(window);$.fn.lazyload=function(options){function update(){var counter=0;elements.each(function(){var $this=$(this);if(!settings.skip_invisible||$this.is(":visible"))if($.abovethetop(this,settings)||$.leftofbegin(this,settings));else if($.belowthefold(this,settings)||$.rightoffold(this,settings)){if(++counter>settings.failure_limit)return!1}else $this.trigger("appear"),counter=0})}var $container,elements=this,settings={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:window,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return options&&(undefined!==options.failurelimit&&(options.failure_limit=options.failurelimit,delete options.failurelimit),undefined!==options.effectspeed&&(options.effect_speed=options.effectspeed,delete options.effectspeed),$.extend(settings,options)),$container=settings.container===undefined||settings.container===window?$window:$(settings.container),0===settings.event.indexOf("scroll")&&$container.bind(settings.event,function(){return update()}),this.each(function(){var self=this,$self=$(self);self.loaded=!1,($self.attr("src")===undefined||$self.attr("src")===!1)&&$self.is("img")&&$self.attr("src",settings.placeholder),$self.one("appear",function(){if(!this.loaded){if(settings.appear){var elements_left=elements.length;settings.appear.call(self,elements_left,settings)}$("<img />").bind("load",function(){var original=$self.attr("data-"+settings.data_attribute);$self.hide(),$self.is("img")?$self.attr("src",original):$self.css("background-image","url('"+original+"')"),$self[settings.effect](settings.effect_speed),self.loaded=!0;var temp=$.grep(elements,function(element){return!element.loaded});if(elements=$(temp),settings.load){var elements_left=elements.length;settings.load.call(self,elements_left,settings)}}).attr("src",$self.attr("data-"+settings.data_attribute))}}),0!==settings.event.indexOf("scroll")&&$self.bind(settings.event,function(){self.loaded||$self.trigger("appear")})}),$window.bind("resize",function(){update()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&$window.bind("pageshow",function(event){event.originalEvent&&event.originalEvent.persisted&&elements.each(function(){$(this).trigger("appear")})}),$(document).ready(function(){update()}),this},$.belowthefold=function(element,settings){var fold;return fold=settings.container===undefined||settings.container===window?(window.innerHeight?window.innerHeight:$window.height())+$window.scrollTop():$(settings.container).offset().top+$(settings.container).height(),$(element).offset().top-settings.threshold>=fold},$.rightoffold=function(element,settings){var fold;return fold=settings.container===undefined||settings.container===window?$window.width()+$window.scrollLeft():$(settings.container).offset().left+$(settings.container).width(),$(element).offset().left-settings.threshold>=fold},$.abovethetop=function(element,settings){var fold;return fold=settings.container===undefined||settings.container===window?$window.scrollTop():$(settings.container).offset().top,fold>=$(element).offset().top+settings.threshold+$(element).height()},$.leftofbegin=function(element,settings){var fold;return fold=settings.container===undefined||settings.container===window?$window.scrollLeft():$(settings.container).offset().left,fold>=$(element).offset().left+settings.threshold+$(element).width()},$.inviewport=function(element,settings){return!($.rightoffold(element,settings)||$.leftofbegin(element,settings)||$.belowthefold(element,settings)||$.abovethetop(element,settings))},$.extend($.expr[":"],{"below-the-fold":function(a){return $.belowthefold(a,{threshold:0})},"above-the-top":function(a){return!$.belowthefold(a,{threshold:0})},"right-of-screen":function(a){return $.rightoffold(a,{threshold:0})},"left-of-screen":function(a){return!$.rightoffold(a,{threshold:0})},"in-viewport":function(a){return $.inviewport(a,{threshold:0})},"above-the-fold":function(a){return!$.belowthefold(a,{threshold:0})},"right-of-fold":function(a){return $.rightoffold(a,{threshold:0})},"left-of-fold":function(a){return!$.rightoffold(a,{threshold:0})}})}(jQuery,window,document);